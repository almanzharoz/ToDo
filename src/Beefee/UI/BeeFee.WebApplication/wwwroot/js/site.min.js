function eventsPageInit(){var n=0,r=10,t=!1,i=!1,u=function(){var u,f;t||i||(i=!0,u=[],$(".class-category").each(function(){$(this).prop("checked")&&u.push($(this).val())}),f=$("<tr><td colspan='3'>Загружаю события...<\/td><\/tr>"),n==0&&$("#listContainer tbody").html(""),$("#listContainer tbody").append(f),Events.loadEvents($("#txtSearchText").val(),$("#startDate").val(),$("#endDate").val(),$("#selectCity option:selected").val()!="0"?$("#selectCity option:selected").text():"",$("#chkConcert").prop("checked"),$("#chkExhibition").prop("checked"),$("#chkExcursion").prop("checked"),$("#chkAllCategories").prop("checked")?[]:u,n,r,$("#maxPrice").val()).done(function(i){i.length<r&&(t=!0);i.length>0?$.each(i,function(n,t){$("#listContainer tbody").append("<tr><td><a target='_blank' href='/event/event/"+t.url+"'>"+t.page.caption+"<\/a><\/td><td>"+t.page.date+"<\/td><td>"+t.page.cover+"<\/td><\/tr>")}):$("#listContainer tbody").html("<tr><td colspan='3'>Событий не найдено<\/td><\/tr>");n++;f.remove()}).fail(function(){$("#listContainer tbody").html("<tr><td colspan='3' class='text-danger'>При выполнении запроса произошла ошибка<\/td><\/tr>")}).always(function(){i=!1}))};$("#btnLoad").click(function(){t=!1;n=0;$("#listContainer tbody").html("");u()});$("#startDate").datetimepicker({format:"DD.MM.YYYY HH:mm"});$("#endDate").datetimepicker({format:"DD.MM.YYYY HH:mm"});$("#chkAllCategories").change(function(){$(".class-category").prop("checked")?$(this).prop("checked")&&$(".class-category").prop("checked",!0):$("#chkAllCategories").prop("checked",!0)});$(".class-category").change(function(){$(".class-category").prop("checked")?$(this).prop("checked")||$("#chkAllCategories").prop("checked",!1):$("#chkAllCategories").prop("checked",!0)});$("#btnLoad").click();$(window).scroll(function(){$(window).scrollTop()+$(window).height()==$(document).height()&&u()})}var Events={loadEvents:function(n,t,i,r,u,f,e,o,s,h,c){var l=$.Deferred();return $.ajax({url:"/event/loadevents",data:{Text:n,StartDate:t,EndDate:i,City:r,LoadConcert:u,LoadExhibition:f,LoadExcursion:e,Categories:o,PageIndex:s,PageSize:h,MaxPrice:c},cache:!1,success:function(n){l.resolve(n.events)},error:function(n,t){l.reject(n,t)}}),l.promise()}};